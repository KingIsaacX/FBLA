<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta tags for proper character encoding and making the page responsive -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Valley Job Board</title>

    <!-- CSS Styles Section -->
    <style>
        /* Define global CSS variables for color scheme, making the website consistent in design */
        :root {
            --primary: #283593;
            /* Primary color for the website */
            --background: #f5f7fb;
            /* Background color */
            --card-bg: white;
            /* Background color for cards */
            --text: #333;
            /* Default text color */
            --text-secondary: #666;
            /* Secondary text color for less emphasis */
        }

        /* Universal reset for all elements: zero margins, paddings, box-sizing, and font family */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, sans-serif;
            /* System font family for consistency */
        }

        /* Body styling: setting the background color and ensuring it takes up the full height */
        body {
            background: var(--background);
            min-height: 100vh;
            /* Ensuring body takes full viewport height */
        }

        /* Navigation bar styling */
        .nav {
            background: var(--primary);
            /* Background set to primary color */
            color: white;
            /* Text color set to white */
            padding: 1rem 0;
            /* Padding inside nav bar */
            position: sticky;
            /* Keep the nav bar fixed on top */
            top: 0;
            /* Position it at the top of the page */
            z-index: 100;
            /* Ensure it stays above other elements */
        }

        /* Styling for the content inside the navigation bar */
        .nav-content {
            max-width: 1200px;
            /* Maximum width for the content */
            margin: 0 auto;
            /* Center the content */
            padding: 0 1rem;
            /* Horizontal padding */
            display: flex;
            /* Flex layout for responsive design */
            justify-content: space-between;
            /* Space between the items */
            align-items: center;
            /* Vertically center items */
        }

        /* Logo styling inside the navigation bar */
        .logo {
            display: flex;
            /* Flexbox layout for logo elements */
            align-items: center;
            /* Vertically center logo image and text */
            gap: 0.5rem;
            /* Gap between logo image and text */
        }

        .logo img {
            height: 40px;
            /* Set height of logo image */
            width: 40px;
            /* Set width of logo image */
        }

        /* Links in the navigation bar styling */
        .nav-links {
            display: flex;
            /* Flexbox for horizontal alignment of links */
            gap: 1.5rem;
            /* Space between links */
        }

        .nav-link {
            color: white;
            /* Set link color to white */
            text-decoration: none;
            /* Remove underline from links */
            padding: 0.5rem;
            /* Add padding for clickable area */
            cursor: pointer;
            /* Change cursor to pointer on hover */
        }

        /* Main content container */
        .container {
            max-width: 1200px;
            /* Maximum width of content */
            margin: 2rem auto;
            /* Center the content with vertical margin */
            padding: 0 1rem;
            /* Padding on left and right */
        }

        /* Header section at the top of the page */
        .header-section {
            display: flex;
            /* Flexbox for aligning elements in the header */
            gap: 1rem;
            /* Space between elements */
            margin-bottom: 2rem;
            /* Margin below the header section */
            align-items: center;
            /* Center items vertically */
        }

        /* Search container for the job search bar */
        .search-container {
            flex: 1;
            /* Allow search bar to take up available space */
            background: white;
            /* White background for the search box */
            border-radius: 8px;
            /* Rounded corners */
            padding: 0.75rem;
            /* Padding inside the search box */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            /* Light shadow effect */
            display: flex;
            /* Flexbox for input and icon alignment */
            align-items: center;
            /* Vertically center input */
        }

        /* Search input styling */
        .search-input {
            border: none;
            /* Remove border */
            outline: none;
            /* Remove outline on focus */
            font-size: 1rem;
            /* Set font size */
            width: 100%;
            /* Make the input field take up full width */
            padding: 0.5rem;
            /* Padding for input */
        }

        /* Container for statistics (active jobs, companies, etc.) */
        .stats-container {
            display: grid;
            /* Grid layout to show stats in rows and columns */
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            /* Responsive grid layout */
            gap: 1rem;
            /* Space between stats */
            margin-bottom: 2rem;
            /* Margin below stats section */
        }

        /* Individual stat card styling */
        .stat-card {
            background: white;
            /* White background for each stat card */
            padding: 1.5rem;
            /* Padding inside each card */
            border-radius: 8px;
            /* Rounded corners */
            text-align: center;
            /* Center text inside cards */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            /* Light shadow effect */
        }

        /* Stat number (main figure) styling */
        .stat-number {
            font-size: 2rem;
            /* Larger font size for the number */
            font-weight: bold;
            /* Bold text */
            color: var(--primary);
            /* Primary color for the stat number */
            margin-bottom: 0.5rem;
            /* Margin below the number */
        }

        /* Job card for displaying job listings */
        .job-card {
            background: white;
            /* White background */
            border-radius: 8px;
            /* Rounded corners */
            padding: 1.5rem;
            /* Padding inside each job card */
            margin-bottom: 1rem;
            /* Space between job cards */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            /* Light shadow effect */
        }

        /* Job title styling */
        .job-title {
            font-size: 1.25rem;
            /* Larger font for job title */
            margin-bottom: 0.5rem;
            /* Margin below the title */
        }

        /* Meta information (company name, job date) styling */
        .job-meta {
            color: var(--text-secondary);
            /* Lighter color for meta information */
            margin-bottom: 1rem;
            /* Space below meta information */
            display: flex;
            /* Flexbox for horizontal layout */
            gap: 1rem;
            /* Space between items */
        }

        /* Button styling */
        .btn {
            background: var(--primary);
            /* Background color set to primary */
            color: white;
            /* Text color set to white */
            border: none;
            /* Remove border */
            padding: 0.75rem 1.5rem;
            /* Padding for button */
            border-radius: 8px;
            /* Rounded corners */
            cursor: pointer;
            /* Pointer cursor on hover */
            font-size: 1rem;
            /* Font size */
        }

        /* Button hover effect */
        .btn:hover {
            opacity: 0.9;
            /* Slightly reduce opacity when hovered */
        }

        /* Modal styling */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Fixed position for modals */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            /* Semi-transparent background */
            z-index: 1000;
            /* Place modals on top */
        }

        /* Content inside modals */
        .modal-content {
            background: white;
            /* White background for modal */
            padding: 2rem;
            /* Padding inside modal */
            border-radius: 8px;
            /* Rounded corners */
            width: 90%;
            /* Modal width */
            max-width: 600px;
            /* Maximum width */
            margin: 2rem auto;
            /* Center modal vertically */
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
            /* Scrollable if content overflows */
        }

        /* Close button inside modals */
        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            /* Lighter color for close button */
        }

        /* Form styling inside modals */
        .form-group {
            margin-bottom: 1rem;
            /* Margin between form groups */
        }

        .form-group label {
            display: block;
            /* Block display for labels */
            margin-bottom: 0.5rem;
            /* Margin below labels */
            font-weight: 500;
            /* Slightly bold label text */
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            /* Make form fields take up full width */
            padding: 0.75rem;
            /* Padding inside input and textarea */
            border: 1px solid #ddd;
            /* Light border */
            border-radius: 4px;
            /* Rounded corners for input fields */
            font-size: 1rem;
            /* Font size for input fields */
        }

        /* Toast message for notifications */
        .toast {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            padding: 1rem 2rem;
            border-radius: 4px;
            color: white;
            /* Text color for the toast */
            background: #4caf50;
            /* Green background for success */
            display: none;
            /* Hidden by default */
            z-index: 2000;
            /* Make sure it appears on top */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            /* Shadow for better visibility */
        }

        .toast.error {
            background: #f44336;
            /* Red background for errors */
        }

        .toast.feedback {
            background: #2196f3;
            /* Blue background for feedback */
        }

        /* Styling for required field markers */
        .required {
            color: #f44336;
            /* Red color for required text */
        }

        /* Styling for application cards (for managing job applications) */
        .application-card {
            border: 1px solid #ddd;
            /* Light border around application cards */
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            background: white;
            /* White background for application cards */
        }

        /* Status for applications (pending, approved, rejected) */
        .status.pending {
            background: #fff3cd;
            /* Yellow background for pending */
            color: #856404;
            /* Dark yellow text */
        }

        .status.approved {
            background: #d4edda;
            /* Green background for approved */
            color: #155724;
            /* Dark green text */
        }

        .status.rejected {
            background: #f8d7da;
            /* Red background for rejected */
            color: #721c24;
            /* Dark red text */
        }

        /* Actions section for application cards */
        .application-actions {
            display: flex;
            gap: 1rem;
            /* Space between action buttons */
            margin-top: 1rem;
            /* Margin on top */
        }

        .btn.approve {
            background: #28a745;
            /* Green background for approve button */
        }

        .btn.reject {
            background: #dc3545;
            /* Red background for reject button */
        }

        /* Mobile view adjustments */
        @media (max-width: 768px) {
            .header-section {
                flex-direction: column;
                /* Stack elements in header vertically */
            }

            .btn {
                width: 100%;
                /* Make buttons full width */
            }

            .nav-links {
                gap: 0.5rem;
                /* Reduce gap between nav links */
            }
        }
    </style>
</head>

<body>
    <!-- Main Navigation Bar -->
    <nav class="nav">
        <div class="nav-content">
            <a href="#" class="nav-link">Great Valley Job Board</a>
            <div class="nav-links">
                <!-- Admin Panel Link (Visible only for Admins) -->
                <a href="#" class="nav-link" id="adminLink" style="display:none;">Admin Panel</a>
                <!-- Login/Register Links (Visible based on user state) -->
                <a href="#" class="nav-link" id="loginLink">Login</a>
                <a href="#" class="nav-link" id="registerLink">Register</a>
            </div>
        </div>
    </nav>

    <!-- Main Content Container -->
    <main class="container">
        <div class="header-section">
            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search jobs...">
            </div>
            <!-- Post Job Button (Visible only for Employers) -->
            <button id="createJobBtn" class="btn" style="display:none;">Post New Job</button>
        </div>

        <!-- Stats Section: Active Jobs, Companies, Applications -->
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="activeJobsCount">0</div>
                <div>Active Jobs</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="companiesCount">0</div>
                <div>Companies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="applicationsCount">0</div>
                <div>Applications</div>
            </div>
        </div>

        <!-- Job Listings Section -->
        <div id="jobListings"></div>
    </main>

    <!-- Modals for login, register, posting jobs, etc. -->
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" name="password" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Register</h2>
            <div class="form-group">
                <label>Register as:</label>
                <select id="roleSelect" required>
                    <option value="">Select role...</option>
                    <option value="student">Student</option>
                    <option value="employer">Employer</option>
                </select>
            </div>
            <form id="registerForm">
                <div id="commonFields">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" name="username" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" name="password" required>
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" name="email" required>
                    </div>
                </div>
                <div id="studentFields" style="display:none;">
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" name="fullName">
                    </div>
                    <div class="form-group">
                        <label>Grade Level</label>
                        <input type="text" name="gradeLevel">
                    </div>
                </div>
                <div id="employerFields" style="display:none;">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" name="companyName">
                    </div>
                    <div class="form-group">
                        <label>Company Website</label>
                        <input type="url" name="website">
                    </div>
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </div>

    <!-- Job Posting Modal -->
    <div id="postJobModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Post New Job</h2>
            <form id="postJobForm">
                <div class="form-group">
                    <label>Job Title <span class="required">*</span></label>
                    <input type="text" name="title" required>
                </div>
                <div class="form-group">
                    <label>Job Type <span class="required">*</span></label>
                    <select name="jobType" required>
                        <option value="">Select type...</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Internship">Internship</option>
                        <option value="Temporary">Temporary</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" name="department">
                </div>
                <div class="form-group">
                    <label>Location <span class="required">*</span></label>
                    <input type="text" name="location" required>
                </div>
                <div class="form-group">
                    <label>Salary Range</label>
                    <div style="display: flex; gap: 1rem;">
                        <input type="number" name="salaryMin" placeholder="Minimum">
                        <input type="number" name="salaryMax" placeholder="Maximum">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description <span class="required">*</span></label>
                    <textarea name="description" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label>Requirements <span class="required">*</span></label>
                    <textarea name="requirements" rows="4" required
                        placeholder="List key requirements, one per line"></textarea>
                </div>
                <div class="form-group">
                    <label>Benefits</label>
                    <textarea name="benefits" rows="3" placeholder="List benefits, one per line"></textarea>
                </div>
                <div class="form-group">
                    <label>Application Deadline</label>
                    <input type="date" name="deadline">
                </div>
                <button type="submit" class="btn">Submit Job Posting</button>
            </form>
        </div>
    </div>

    <!-- Apply for Job Modal -->
    <div id="applyModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Apply for Position</h2>
            <form id="applyForm">
                <div class="form-group">
                    <label>Full Name <span class="required">*</span></label>
                    <input type="text" name="fullName" required>
                </div>
                <div class="form-group">
                    <label>Email <span class="required">*</span></label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label>Phone <span class="required">*</span></label>
                    <input type="tel" name="phone" required>
                </div>
                <div class="form-group">
                    <label>Current Grade Level <span class="required">*</span></label>
                    <select name="gradeLevel" required>
                        <option value="">Select grade...</option>
                        <option value="9">9th Grade</option>
                        <option value="10">10th Grade</option>
                        <option value="11">11th Grade</option>
                        <option value="12">12th Grade</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>GPA</label>
                    <input type="number" name="gpa" step="0.01" min="0" max="4">
                </div>
                <div class="form-group">
                    <label>Relevant Coursework</label>
                    <textarea name="coursework" rows="3" placeholder="List relevant courses you've taken"></textarea>
                </div>
                <div class="form-group">
                    <label>Experience</label>
                    <textarea name="experience" rows="4"
                        placeholder="Describe any relevant experience, including clubs, volunteer work, or previous jobs"></textarea>
                </div>
                <div class="form-group">
                    <label>Skills</label>
                    <textarea name="skills" rows="3" placeholder="List your relevant skills"></textarea>
                </div>
                <div class="form-group">
                    <label>Cover Letter <span class="required">*</span></label>
                    <textarea name="coverLetter" rows="6" required
                        placeholder="Why are you interested in this position? What makes you a good fit?"></textarea>
                </div>
                <div class="form-group">
                    <label>References</label>
                    <textarea name="references" rows="3"
                        placeholder="List any references with their contact information"></textarea>
                </div>
                <button type="submit" class="btn">Submit Application</button>
            </form>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Admin Panel</h2>
            <div id="pendingJobs"></div>
        </div>
    </div>

    <!-- Manage Applications Modal -->
    <div id="manageApplicationsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Manage Applications</h2>
            <div id="applicationsContainer"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Storage Configuration for Jobs, Users, Applications, and Current User
        const STORAGE_KEYS = {
            JOBS: 'jobs',
            USERS: 'users',
            APPLICATIONS: 'applications',
            CURRENT_USER: 'currentUser'
        };

        // Initialize default data if none exists in localStorage
        function initializeStorage() {
            if (!localStorage.getItem(STORAGE_KEYS.JOBS)) {
                localStorage.setItem(STORAGE_KEYS.JOBS, JSON.stringify([]));
            }
            if (!localStorage.getItem(STORAGE_KEYS.USERS)) {
                localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify([{
                    id: 'admin1',
                    username: 'admin',
                    password: 'admin123',
                    role: 'admin'
                }]));
            }
            if (!localStorage.getItem(STORAGE_KEYS.APPLICATIONS)) {
                localStorage.setItem(STORAGE_KEYS.APPLICATIONS, JSON.stringify([]));
            }
        }

        // Utility Functions to fetch and save data to localStorage
        function getData(key) {
            return JSON.parse(localStorage.getItem(key)) || [];
        }

        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Toast Notification Function to display messages
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${isError ? 'error' : ''}`;
            toast.style.display = 'block';
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }

        // Close all modals
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        document.querySelectorAll('.modal .close').forEach(closeBtn => {
            closeBtn.onclick = () => closeBtn.closest('.modal').style.display = 'none';
        });

        window.onclick = (event) => {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };

        // Authentication Functions
        document.getElementById('loginLink').onclick = () => {
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            if (currentUser) {
                localStorage.removeItem(STORAGE_KEYS.CURRENT_USER);
                updateUIForUser(null); // Update UI on logout
                showToast('Logged out successfully');
                return;
            }
            document.getElementById('loginModal').style.display = 'block';
        };

        document.getElementById('loginForm').onsubmit = (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const username = formData.get('username');
            const password = formData.get('password');

            const users = getData(STORAGE_KEYS.USERS);
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(user));
                closeAllModals();
                e.target.reset();
                updateUIForUser(user);
                showToast('Logged in successfully');
                renderJobs();
            } else {
                showToast('Invalid credentials', true);
            }
        };

        // Registration Function
        document.getElementById('registerLink').onclick = () => {
            document.getElementById('registerModal').style.display = 'block';
        };

        document.getElementById('roleSelect').onchange = (e) => {
            const studentFields = document.getElementById('studentFields');
            const employerFields = document.getElementById('employerFields');

            studentFields.style.display = e.target.value === 'student' ? 'block' : 'none';
            employerFields.style.display = e.target.value === 'employer' ? 'block' : 'none';
        };

        document.getElementById('registerForm').onsubmit = (e) => {
            e.preventDefault();
            const role = document.getElementById('roleSelect').value;
            if (!role) {
                showToast('Please select a role', true);
                return;
            }

            const formData = new FormData(e.target);
            const userData = {
                id: Date.now().toString(),
                username: formData.get('username'),
                password: formData.get('password'),
                email: formData.get('email'),
                role: role
            };

            if (role === 'student') {
                userData.fullName = formData.get('fullName');
                userData.gradeLevel = formData.get('gradeLevel');
            } else {
                userData.companyName = formData.get('companyName');
                userData.website = formData.get('website');
            }

            const users = getData(STORAGE_KEYS.USERS);
            if (users.some(user => user.username === userData.username)) {
                showToast('Username already exists', true);
                return;
            }

            users.push(userData);
            saveData(STORAGE_KEYS.USERS, users);

            closeAllModals();
            e.target.reset();
            document.getElementById('roleSelect').value = '';
            document.getElementById('studentFields').style.display = 'none';
            document.getElementById('employerFields').style.display = 'none';
            updateUIForUser(userData);
            showToast('Registration successful!');
        };

        // Post New Job Functions
        document.getElementById('createJobBtn').onclick = () => {
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            if (!currentUser || currentUser.role !== 'employer') {
                showToast('Please login as an employer to post jobs', true);
                return;
            }
            document.getElementById('postJobModal').style.display = 'block';
        };

        document.getElementById('postJobForm').onsubmit = (e) => {
            e.preventDefault();
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            const formData = new FormData(e.target);

            const jobData = {
                id: Date.now().toString(),
                employerId: currentUser.id,
                company: currentUser.companyName,
                title: formData.get('title'),
                jobType: formData.get('jobType'),
                department: formData.get('department'),
                location: formData.get('location'),
                salaryRange: {
                    min: formData.get('salaryMin'),
                    max: formData.get('salaryMax')
                },
                description: formData.get('description'),
                requirements: formData.get('requirements'),
                benefits: formData.get('benefits'),
                deadline: formData.get('deadline'),
                status: 'pending',
                createdAt: new Date().toISOString()
            };

            const jobs = getData(STORAGE_KEYS.JOBS);
            jobs.push(jobData);
            saveData(STORAGE_KEYS.JOBS, jobs);

            closeAllModals();
            e.target.reset();
            showToast('Job posted successfully! Waiting for admin approval');
            renderJobs();
            updateStats();
        };

        // Admin Panel Functions
        document.getElementById('adminLink').onclick = () => {
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            if (!currentUser || currentUser.role !== 'admin') {
                showToast('Admin access only', true);
                return;
            }

            renderPendingJobs();
            document.getElementById('adminModal').style.display = 'block';
        };

        // Render pending jobs for admin review
        function renderPendingJobs() {
            const pendingJobs = getData(STORAGE_KEYS.JOBS).filter(job => job.status === 'pending');
            const container = document.getElementById('pendingJobs');

            container.innerHTML = pendingJobs.length === 0 ? '<p>No pending jobs</p>' :
                pendingJobs.map(job => ` 
                    <div class="job-card">
                        <h3>${job.title}</h3>
                        <p><strong>Company:</strong> ${job.company}</p>
                        <p>${job.description}</p>
                        <div class="job-meta">${new Date(job.createdAt).toLocaleDateString()}</div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button onclick="approveJob('${job.id}')" class="btn">Approve</button>
                            <button onclick="rejectJob('${job.id}')"
                                class="btn" style="background: #f44336;">Reject</button>
                        </div>
                    </div>
                `).join('');
        }

        // Job Actions (Approve or Reject Jobs)
        window.approveJob = (jobId) => {
            const jobs = getData(STORAGE_KEYS.JOBS);
            const jobIndex = jobs.findIndex(job => job.id === jobId);
            if (jobIndex !== -1) {
                jobs[jobIndex].status = 'approved';
                saveData(STORAGE_KEYS.JOBS, jobs);
                renderPendingJobs();
                renderJobs();
                updateStats();
                showToast('Job approved');
            }
        };

        window.rejectJob = (jobId) => {
            const jobs = getData(STORAGE_KEYS.JOBS);
            const jobIndex = jobs.findIndex(job => job.id === jobId);
            if (jobIndex !== -1) {
                jobs[jobIndex].status = 'rejected';
                saveData(STORAGE_KEYS.JOBS, jobs);
                renderPendingJobs();
                renderJobs();
                updateStats();
                showToast('Job rejected');
            }
        };

        // Job Search and Display
        document.getElementById('searchInput').oninput = (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const jobs = getData(STORAGE_KEYS.JOBS)
                .filter(job => job.status === 'approved')
                .filter(job =>
                    job.title.toLowerCase().includes(searchTerm) ||
                    job.company.toLowerCase().includes(searchTerm) ||
                    job.description.toLowerCase().includes(searchTerm)
                );

            renderJobs(jobs);
        };

        function renderJobs(jobsToDisplay) {
            const jobs = jobsToDisplay || getData(STORAGE_KEYS.JOBS).filter(job => job.status === 'approved');
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            const container = document.getElementById('jobListings');

            container.innerHTML = jobs.length === 0 ? '<p>No jobs found</p>' :
                jobs.map(job => `
                    <div class="job-card">
                        <h3 class="job-title">${job.title}</h3>
                        <div class="job-meta">
                            <span>${job.company}</span>
                            <span>${new Date(job.createdAt).toLocaleDateString()}</span>
                        </div>
                        <p>${job.description}</p>
                        <div class="job-requirements">
                            <h4>Requirements:</h4>
                            <p>${job.requirements}</p>
                        </div>
                        ${currentUser && currentUser.role === 'student' ?
                        `<button onclick="showApplyForm('${job.id}')" class="btn">Apply Now</button>` : ''}
                        ${currentUser && currentUser.role === 'employer' && job.employerId === currentUser.id ?
                        `<button onclick="showApplications('${job.id}')" class="btn">View Applications (${getApplicationCount(job.id)})</button>` : ''}
                    </div>
                `).join('');
        }

        // Application System for Students to apply
        window.showApplyForm = (jobId) => {
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            if (!currentUser || currentUser.role !== 'student') {
                showToast('Please login as a student to apply', true);
                return;
            }

            const applyModal = document.getElementById('applyModal');
            applyModal.dataset.jobId = jobId;
            applyModal.style.display = 'block';
        };

        document.getElementById('applyForm').onsubmit = (e) => {
            e.preventDefault();
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            const jobId = e.target.closest('.modal').dataset.jobId;
            const formData = new FormData(e.target);

            const applicationData = {
                id: Date.now().toString(),
                jobId: jobId,
                userId: currentUser.id,
                fullName: formData.get('fullName'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                gradeLevel: formData.get('gradeLevel'),
                gpa: formData.get('gpa'),
                coursework: formData.get('coursework'),
                experience: formData.get('experience'),
                skills: formData.get('skills'),
                coverLetter: formData.get('coverLetter'),
                references: formData.get('references'),
                status: 'PENDING',
                submittedAt: new Date().toISOString()
            };

            const applications = getData(STORAGE_KEYS.APPLICATIONS);
            applications.push(applicationData);
            saveData(STORAGE_KEYS.APPLICATIONS, applications);

            closeAllModals();
            e.target.reset();
            showToast('Application submitted successfully');
            updateStats();
        };

        // Application Management
        function getApplicationCount(jobId) {
            return getData(STORAGE_KEYS.APPLICATIONS)
                .filter(app => app.jobId === jobId).length;
        }

        window.showApplications = (jobId) => {
            const applications = getData(STORAGE_KEYS.APPLICATIONS)
                .filter(app => app.jobId === jobId);
            const container = document.getElementById('applicationsContainer');
            const modal = document.getElementById('manageApplicationsModal');

            container.innerHTML = applications.length === 0 ?
                '<p>No applications yet</p>' :
                applications.map(app => `
                    <div class="application-card">
                        <span class="status ${app.status.toLowerCase()}">${app.status}</span>
                        <h3>${app.fullName}</h3>
                        <div>
                            <strong>Email:</strong> ${app.email}<br>
                            <strong>Phone:</strong> ${app.phone}<br>
                            <strong>Grade Level:</strong> ${app.gradeLevel}<br>
                            ${app.gpa ? `<strong>GPA:</strong> ${app.gpa}<br>` : ''}
                        </div>
                        
                        <div style="margin: 1rem 0">
                            <strong>Cover Letter:</strong>
                            <p>${app.coverLetter}</p>
                        </div>
                        
                        ${app.experience ? `
                            <div style="margin: 1rem 0">
                                <strong>Experience:</strong>
                                <p>${app.experience}</p>
                            </div>
                        ` : ''}
                        
                        ${app.coursework ? `
                            <div style="margin: 1rem 0">
                                <strong>Relevant Coursework:</strong>
                                <p>${app.coursework}</p>
                            </div>
                        ` : ''}
                        
                        ${app.skills ? `
                            <div style="margin: 1rem 0">
                                <strong>Skills:</strong>
                                <p>${app.skills}</p>
                            </div>
                        ` : ''}

                        ${app.references ? `
                            <div style="margin: 1rem 0">
                                <strong>References:</strong>
                                <p>${app.references}</p>
                            </div>
                        ` : ''}

                        <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-secondary);">
                            Submitted: ${new Date(app.submittedAt).toLocaleString()}
                        </div>

                        ${app.status === 'PENDING' ? `
                            <div class="application-actions">
                                <button onclick="handleApplication('${app.id}', 'APPROVED')" 
                                    class="btn approve">Approve</button>
                                <button onclick="handleApplication('${app.id}', 'REJECTED')" 
                                    class="btn reject">Reject</button>
                            </div>
                        ` : ''}
                    </div>
                `).join('');

            modal.style.display = 'block';
        };

        window.handleApplication = (applicationId, status) => {
            const applications = getData(STORAGE_KEYS.APPLICATIONS);
            const index = applications.findIndex(app => app.id === applicationId);

            if (index !== -1) {
                applications[index].status = status;
                applications[index].updatedAt = new Date().toISOString();

                saveData(STORAGE_KEYS.APPLICATIONS, applications);
                showApplications(applications[index].jobId);
                showToast(`Application ${status.toLowerCase()}`);
            }
        };

        // Stats Management
        function updateStats() {
            const jobs = getData(STORAGE_KEYS.JOBS);
            const applications = getData(STORAGE_KEYS.APPLICATIONS);

            document.getElementById('activeJobsCount').textContent =
                jobs.filter(job => job.status === 'approved').length;

            document.getElementById('companiesCount').textContent =
                [...new Set(jobs.filter(job => job.status === 'approved')
                    .map(job => job.company))].length;

            document.getElementById('applicationsCount').textContent = applications.length;
        }

        // UI State Management for user-specific features (login/logout, admin panel, post job button)
        function updateUIForUser(user) {
            const adminLink = document.getElementById('adminLink');
            const createJobBtn = document.getElementById('createJobBtn');
            const loginLink = document.getElementById('loginLink');
            const registerLink = document.getElementById('registerLink');

            if (user) {
                loginLink.textContent = 'Logout'; // Change link text to "Logout" when logged in
                registerLink.style.display = 'none'; // Hide register link when logged in
                adminLink.style.display = user.role === 'admin' ? 'block' : 'none'; // Show admin panel for admins
                createJobBtn.style.display = user.role === 'employer' ? 'block' : 'none'; // Show job posting for employers
            } else {
                loginLink.textContent = 'Login'; // Change to "Login" when logged out
                registerLink.style.display = 'block'; // Show register link when logged out
                adminLink.style.display = 'none'; // Hide admin panel link when not logged in
                createJobBtn.style.display = 'none'; // Hide job posting button when not logged in
            }
        }

        // Initialize the application by loading data from localStorage
        function initializeApp() {
            initializeStorage(); // Initialize storage if no data exists
            const currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER));
            updateUIForUser(currentUser); // Update UI based on current user
            renderJobs(); // Render job listings
            updateStats(); // Update stats on page load
        }

        // Start the application when the DOM content is fully loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>

</html>